{% extends 'base.html' %}

{% block title %}Wichtigkeits-Fragebogen{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            ðŸ“Š Wie wichtig sind dir diese Red Flags?
        </h1>
        
        <!-- ErklÃ¤rung fÃ¼r Nutzer -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
            <p class="text-blue-900 font-medium mb-2">ðŸ’¡ Warum ist das wichtig?</p>
            <p class="text-blue-800">
                {{ importance_explanation }}
            </p>
        </div>
        
        {% if has_completed %}
        <div class="bg-green-50 border-l-4 border-green-400 p-4">
            <p class="text-green-700">
                âœ“ Du hast diesen Fragebogen bereits ausgefÃ¼llt. Du kannst deine Bewertungen jederzeit aktualisieren.
            </p>
        </div>
        {% else %}
        <div class="bg-orange-50 border-l-4 border-orange-400 p-4">
            <p class="text-orange-700">
                ðŸ’¡ <strong>Tipp:</strong> 1 = Unwichtig, 5 = Sehr wichtig. Sei ehrlich - es gibt keine richtigen oder falschen Antworten!
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Form -->
    <form method="post" action="{% url 'questionnaire:importance_submit' %}" class="space-y-8">
        {% csrf_token %}
        
        {% for category, questions in questions_by_category.items %}
            {% if questions %}
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 pb-3 border-b-2 border-red-flag">
                    {{ category }}
                </h2>
                
                <div class="space-y-6">
                    {% for question in questions %}
                    <div class="border-b border-gray-200 pb-6 last:border-0">
                        <label class="block mb-3">
                            <span class="text-gray-800 font-medium">{{ question.get_text }}</span>
                        </label>
                        
                        <!-- Importance Slider (1-5) -->
                        <div class="flex items-center gap-4">
                            <span class="text-sm text-gray-500 font-bold w-20">Unwichtig</span>
                            
                            <div class="flex-1">
                                <input 
                                    type="range" 
                                    name="importance_{{ question.key }}" 
                                    min="1" 
                                    max="5" 
                                    value="{% if existing_weights %}{{ existing_weights|get_item:question.key|default:3 }}{% else %}3{% endif %}"
                                    class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-flag"
                                    oninput="document.getElementById('value_{{ question.key }}').textContent = this.value"
                                    required
                                >
                                <div class="flex justify-between text-sm text-gray-400 mt-2 px-1">
                                    <span class="font-bold">1</span>
                                    <span class="font-bold">2</span>
                                    <span class="font-bold">3</span>
                                    <span class="font-bold">4</span>
                                    <span class="font-bold">5</span>
                                </div>
                            </div>
                            
                            <span class="text-sm text-gray-500 font-bold w-24">Sehr wichtig</span>
                            
                            <!-- Current Value Display -->
                            <div class="w-16 text-center">
                                <span id="value_{{ question.key }}" class="text-3xl font-bold text-red-flag">
                                    {% if existing_weights %}{{ existing_weights|get_item:question.key|default:3 }}{% else %}3{% endif %}
                                </span>
                                <span class="text-xs text-gray-500 block">/5</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        {% endfor %}

        <!-- Submit Button -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex gap-4">
                <button 
                    type="submit" 
                    class="flex-1 bg-red-flag hover:bg-red-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transition transform hover:scale-105"
                >
                    {% if has_completed %}
                    ðŸ’¾ Bewertungen aktualisieren
                    {% else %}
                    âœ“ Bewertungen speichern
                    {% endif %}
                </button>
                
                <a 
                    href="{% url 'questionnaire:home' %}" 
                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-4 px-8 rounded-lg transition"
                >
                    Abbrechen
                </a>
            </div>
        </div>
    </form>
</div>

<!-- Custom filter fÃ¼r dict lookup -->
{% load custom_filters %}
{% endblock %}
